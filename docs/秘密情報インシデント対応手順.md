# 秘密情報インシデント対応手順（Firebaseサービスアカウント鍵）

## 1. いま実施済みの対策

- `firebase.json`（実鍵入り）を作業ツリーから削除
- `.gitignore` に鍵ファイルの除外ルールを追加
- `firebase.service-account.example.json` を追加し、サンプル運用へ変更
- `README.md` / `.env.example` に運用ルールを明記

## 2. 直ちに必要な手作業（必須）

1. Firebase Console で流出したサービスアカウント鍵を失効
2. 新しい鍵を再発行
3. 新鍵はローカル専用ファイル（例: `firebase.service-account.local.json`）で保管
4. `.env` の `FIREBASE_SERVICE_ACCOUNT_JSON` を新ファイルパスに更新

## 3. Git履歴からの完全除去（推奨）

過去コミットに秘密鍵が含まれていたため、履歴削除が必要です。

確認できた履歴例:
- `029e558`
- `bee94aa`

`git filter-repo` が利用可能な場合:

```bash
git filter-repo --path firebase.json --invert-paths
git push --force --all
git push --force --tags
```

注意:
- 履歴改変後は全メンバーのローカルブランチ再同期が必要です。
- 実施前にチームへ周知してください。

## 4. 再発防止チェック

以下のコマンドで、鍵文字列の混入がないか定期チェックしてください。

```bash
rg "BEGIN PRIVATE KEY|private_key|service_account" -n .
```
